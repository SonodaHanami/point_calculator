<!DOCTYPE html>
<html>

<head>
    <title>Point Calculator</title>
    <style>
        .target {
            color: #0000ff;
        }

        .coin {
            color: #114514;
        }

        .count {
            color: #ee5511;
        }

        .input{
            height:30px;
        }

        .solveButton {
            width: 100%;
            height: 40px;
        }
    </style>
</head>

<body>
    <h1>Point Calculator</h1>
    <h3>这是一个可以用于各种游戏控分的计算器</h3>
    <h4>（有累计分数排行榜的地方就有控分！）</h4>
    <div>
        点个Star吧！
        <iframe
            src="https://ghbtns.com/github-btn.html?user=SonodaHanami&repo=point_calculator&type=star&count=true&size=large"
            frameborder="0" scrolling="0" width="170" height="30" title="GitHub">
        </iframe>
    </div>
    <div>
        <p>
            <a href="javascript:void(0);" onclick="handleSwitch('usage', 'usageSwitch')">
                点击<span id="usageSwitch">展开</span>使用方法
            </a>
        </p>
        <div id="usage" style="display:none">
            <p>在 target 处填入 <span><b>目标分数</b></span></p>
            <p>在 current 处填入 <span><b>当前分数</b></span></p>
            <p>在 coins 处填入分数选项，以空格分隔，例如：114 514</p>
            <p>（为什么是coins？因为这就是“硬币问题”）</p>
            <p>然后点击 <span><b>计算</b></span></p>
        </div>
        <p>
            <a href="javascript:void(0);" onclick="handleSwitch('default', 'defaultSwitch')">
                点击<span id="defaultSwitch">展开</span>一些可能能用得上的预设值
            </a>
        </p>
        <div id="default" style="display:none">
            <table border="1"  cellspacing="2" cellpadding="2">
                <tr>
                    <td rowspan="3">target</td>
                    <td id="t1">5200912</td>
                    <td><input type="submit" value="使用" onclick="paste('target', t1);"></td>
                </tr>
                <tr>
                    <td id="t2">2701314</td>
                    <td><input type="submit" value="使用" onclick="paste('target', t2);"></td>
                </tr>
                <tr>
                    <td id="t3">1314912</td>
                    <td><input type="submit" value="使用" onclick="paste('target', t3);"></td>
                </tr>
                <tr>
                    <td rowspan="3">coins</td>
                    <td>SIF SM: <span id="c1">119 59 34 14</span></td>
                    <td><input type="submit" value="使用" onclick="paste('coins', c1);"></td>
                </tr>
                <tr>
                    <td>SIF 协力: <span id="c2">100 51 29 13</span></td>
                    <td><input type="submit" value="使用" onclick="paste('coins', c2);"></td>
                </tr>
                <tr>
                    <td>LLAS: <span id="c3">875 600</span></td>
                    <td><input type="submit" value="使用" onclick="paste('coins', c3);"></td>
                </tr>
            </table>
            <p>还是看看远方的<b>LoveLive! AS Wiki</b>吧！
                <a href="https://wiki.loveliv.es/%E6%B4%BB%E5%8A%A8pt%E9%80%9F%E6%9F%A5%E8%A1%A8" target="_blank">
                    https://wiki.loveliv.es/活动pt速查表
                </a>
            </p>
        </div>
        <hr />
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td>target: </td>
                <td><input type="text" class="input" id="target" placeholder="目标"></td>
            </tr>
            <tr>
                <td>current: </td>
                <td><input type="text" class="input" id="current" placeholder="当前" value="0"></td>
            </tr>
            <tr>
                <td>coins: </td>
                <td><input type="text" class="input" id="coins" placeholder="分数选项"></td>
            </tr>
            <tr>
                <td colspan="2"><input type="submit" class="solveButton" value="计算" onclick="solve();"></td>
            </tr>
        </table>
    </div>
    <hr />

    <div id="result">
        <p>计算结果将在这里显示</p>
        <p>所有计算过程都在浏览器本地运行，请量力而行</p>
    </div>

    <script>
        function solve() {
            var t0 = new Date();
            // 检查输入
            var target, current, coins;
            target = document.getElementById('target');
            current = document.getElementById('current');
            coins = document.getElementById('coins');
            if (target.value) {
                target = parseInt(target.value, 10);
            }
            else {
                document.getElementById('result').innerHTML = '请输入target';
                return;
            }
            if (current.value) {
                current = parseInt(document.getElementById('current').value, 10);
            }
            else {
                document.getElementById('result').innerHTML = '请输入current';
                return;
            }
            offset = target - current;
            if ((offset <= 0) || !(Math.floor(offset) === offset)) {
                document.getElementById('result').innerHTML = `唔得，target - current = ${offset} 不是正整数`;
                return;
            }
            target = offset;
            if (coins.value) {
                coins = coins.value.trim().split(' ').map(x => +x);
            }
            else {
                document.getElementById('result').innerHTML = '请输入coins';
                return;
            }
            for (var coin of coins) {
                if ((coin <= 0) || !(Math.floor(coin) === coin)) {
                    document.getElementById('result').innerHTML = `唔得，coins中 ${coin} 不是正整数`;
                    return;
                }
            }
            // 计算
            var result = {};
            var resultItems = [];
            var plans = new Array(target + 1);
            plans[0] = [target + 1, 0];
            for (var i = 1; i <= target; i++) {
                plans[i] = [0, 0];
            }
            for (var i = 1; i <= target; i++) {
                if (coins.includes(i)) {
                    plans[i] = [1, i];
                }
                else {
                    var min_count = target + 1;
                    var min_prev_target = 0;
                    for (var coin of coins) {
                        if (i >= coin) {
                            var new_count = plans[i - coin][0] + 1;
                            if (new_count < min_count) {
                                min_count = new_count;
                                min_prev_target = coin;
                            }
                        }
                    }
                    plans[i] = [min_count, min_prev_target];
                }
            }
            // 输出结果
            if (plans[target][0] > target) {
                document.getElementById('result').innerHTML = [
                    'target: ' + target,
                    'coins: ' + coins,
                    '算不出来，damedane~',
                    '计算耗时' + (new Date() - t0) + 'ms'
                ].join('<br>');
            }
            else {
                var remaining = target;
                while (remaining > 0) {
                    coin = plans[remaining][1];
                    if (coin in result) {
                        result[coin] += 1;
                    }
                    else {
                        result[coin] = 1;
                    }
                    remaining -= coin;
                }
                for (var k in result) {
                    resultItems.push(
                        '<span class="coin">' + k + '</span> * <span class="count">' + result[k] + '</span>'
                    );
                }
                document.getElementById('result').innerHTML = [
                    'target: ' + target,
                    'coins: ' + coins.join(', '),
                    target + ' 最少可由以下 ' + plans[target][0] + ' 项相加得到：',
                    '<h3><span class="target">' + target + '</span> = ' + resultItems.join(' + ') + '</h3>',
                    '计算耗时 ' + (new Date() - t0) + 'ms'
                ].join('<br>');
            }
        }

        function paste(target, valueSource) {
            document.getElementById(target).value = valueSource.innerHTML;
        }

        function handleSwitch(table, text){
            if (document.getElementById(table).style.display == "none"){
                document.getElementById(table).style.display="";
                document.getElementById(text).innerHTML="收起";
            }
            else {
                document.getElementById(table).style.display="none";
                document.getElementById(text).innerHTML="展开";
            }
        }

        const inputIds = ['target', 'current', 'coins']
        for(var i in inputIds) {
            document.getElementById(inputIds[i]).onkeyup = function(event) {
                if(event.which == 13) {
                    solve();
                }
            }
        }
    </script>
</body>

</html>